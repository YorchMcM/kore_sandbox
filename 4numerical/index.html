
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../3nondim/">
      
      
        <link rel="next" href="../5implementation/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44">
    
    
      
        <title>Numerical scheme - User Manual</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#numerical-scheme" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="User Manual" class="md-header__button md-logo" aria-label="User Manual" data-md-component="logo">
      
  <img src="../assets/test1.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            User Manual
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Numerical scheme
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Introduction

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../1installation/" class="md-tabs__link">
        
  
    
  
  Installation Notes

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../2definition/" class="md-tabs__link">
        
  
    
  
  Physical definition

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../3nondim/" class="md-tabs__link">
        
  
    
  
  Non-dimensionalization

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  Numerical scheme

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../5implementation/" class="md-tabs__link">
        
  
    
  
  Software implementation

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="User Manual" class="md-nav__button md-logo" aria-label="User Manual" data-md-component="logo">
      
  <img src="../assets/test1.png" alt="logo">

    </a>
    User Manual
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../1installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation Notes
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../2definition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Physical definition
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../3nondim/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Non-dimensionalization
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Numerical scheme
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Numerical scheme
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#poloidal-toroidal-decomposition-and-the-u-and-v-sections" class="md-nav__link">
    <span class="md-ellipsis">
      Poloidal-toroidal decomposition and the \(u\) and \(v\) sections
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#angular-discretization-operators-and-symmetry" class="md-nav__link">
    <span class="md-ellipsis">
      Angular discretization, operators and symmetry
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#radial-discretization-inner-cores-and-symmetry-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Radial discretization, inner cores and symmetry considerations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#boundary-conditions-generalization-and-final-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Boundary conditions, generalization and final notes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../5implementation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software implementation
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#poloidal-toroidal-decomposition-and-the-u-and-v-sections" class="md-nav__link">
    <span class="md-ellipsis">
      Poloidal-toroidal decomposition and the \(u\) and \(v\) sections
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#angular-discretization-operators-and-symmetry" class="md-nav__link">
    <span class="md-ellipsis">
      Angular discretization, operators and symmetry
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#radial-discretization-inner-cores-and-symmetry-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Radial discretization, inner cores and symmetry considerations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#boundary-conditions-generalization-and-final-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Boundary conditions, generalization and final notes
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="numerical-scheme">Numerical scheme</h1>
<p>In order to solve <a href="https://yorchmcm.github.io/kore_sandbox/3nondim/">the non-dimensional problem</a>, the implementation of Kore is quite the opposite of straightforward, but the methods are traditional. Below, the translation between the non-dimensional equations and the <a href="https://yorchmcm.github.io/kore_sandbox/5implementation/">software implementation</a> will be presented. An attempt has been made at dividing this section and its steps in a way in which the relationship with the different parts of Kore are as clear as possible. The momentum equation without the Lorentz force and the rotation time scale is used to illustrate the procedure, which is extendable to all other equations and terms.</p>
<p>In short, Kore writes <span class="arithmatex">\(\mathbf u\)</span> and <span class="arithmatex">\(\mathbf b\)</span> in their poloidal and toroidal components. Discretization of the problem is made in terms of frequency, with spherical harmonics serving for angular discretization and Chebyshev polynomials serving for radial discretization. The differential system in the unknowns then turns into a large algebraic linear system in their coefficients, which is solved as an eigenvalue problem if a forcing is not specified (or solved directly otherwise).</p>
<h2 id="poloidal-toroidal-decomposition-and-the-u-and-v-sections">Poloidal-toroidal decomposition and the <span class="arithmatex">\(u\)</span> and <span class="arithmatex">\(v\)</span> sections</h2>
<p>Possibly the best place to start could be the way in which the vector equations are <em>dissected</em>. This decomposition is not motivated by software, but rather has been a traditional manner in which to study rotating flows (see e.g. <a href="https://journals.aps.org/pre/abstract/10.1103/PhysRevE.59.1789">Tilgner 1999</a>). It should be noted that, although it hasn't been explicitely mentioned in <a href="https://yorchmcm.github.io/kore_sandbox/2definition/">Physical Definition</a>, a (quasi-)incompressible fluid can only produce a divergence-less velocity field <span class="arithmatex">\(\mathbf u\)</span> by virtue of the continuity equation. Similarly, <a href="https://en.wikipedia.org/wiki/Gauss%27s_law_for_magnetism">Gauss' law for a magnetic field</a> imposes a divergence-less induced magnetic field <span class="arithmatex">\(\mathbf b\)</span>. These conditions impose further constraints on the relationship between the components of each vector field, reducing the number of actual free parameters from three per field to just two.</p>
<p>Rather than using the actual components of the (e.g. velocity) field, it has been a traditional approach to express the vector by mean of two scalar quantites, <span class="arithmatex">\(\mathcal P\)</span> and <span class="arithmatex">\(\mathcal T\)</span>, called the <em>poloidal</em> and <em>toroidal</em> potentials respectively, as follows:</p>
<div class="arithmatex">\[
\mathbf u = \nabla\times\nabla\times(\mathcal P\mathbf r) + \nabla\times(\mathcal T\mathbf r)
\]</div>
<p>The magnetic field <span class="arithmatex">\(\mathbf b\)</span> is written in a similar way, but the poloidal and toroidal potentials are denoted <span class="arithmatex">\(\mathcal F\)</span> and <span class="arithmatex">\(\mathcal G\)</span> respectively. Note that, because <span class="arithmatex">\(\mathbf u\)</span> is given as the <em>curls</em> of vectors, the condition of zero divergence is automatically satisfied. However, because we now have two unknowns rather than three, the original momentum (or induction) equation cannot be used. Instead, the <span class="arithmatex">\(u\)</span> and <span class="arithmatex">\(v\)</span> sections are used. The <span class="arithmatex">\(u\)</span> section is the radial projection of the second curl of the momentum equation (<span class="arithmatex">\(\hat{\mathbf r}\cdot\nabla\times\nabla\times\)</span>), while the <span class="arithmatex">\(v\)</span> section is the radial projection of the first curl of the momentum equation (<span class="arithmatex">\(\hat{\mathbf r}\cdot\nabla\times\)</span>). For simplicity reasons, however, the projection will be performed here by dot-multiplication with <span class="arithmatex">\(\mathbf r\)</span> rather than <span class="arithmatex">\(\hat{\mathbf r}\)</span>. The same thing is done for the induction equation, where Kore now calls the sections <span class="arithmatex">\(f\)</span> and <span class="arithmatex">\(g\)</span> rather than <span class="arithmatex">\(u\)</span> and <span class="arithmatex">\(v\)</span> respectively. Each section is now one scalar equation, and the two sections together allow to solve for the two scalar unknowns.</p>
<p>Finally, it will be explicitely noted that the poloidal and toroidal potentials are time-independent complex functions, by virtue of <span class="arithmatex">\(\mathbf u\)</span> (or <span class="arithmatex">\(\mathbf b\)</span>) having these same properties.</p>
<h2 id="angular-discretization-operators-and-symmetry">Angular discretization, operators and symmetry</h2>
<p>The introduction of the poloidal and toroidal potentials leaves us with a set of <em>explicitely</em> scalar equations and unknowns. Each of this unknowns is a complex number with a purely spatial dependance, which is advantegously expressed in terms of the radial <span class="arithmatex">\(r\)</span>, colatitude <span class="arithmatex">\(\theta\)</span> and longitude <span class="arithmatex">\(\varphi\)</span> spherical coordinates given the (quasi-)spherical symmetry of the problem at hand. It is thus reasonable to expand the unknowns in <a href="https://en.wikipedia.org/wiki/Spherical_harmonics">spherical harmonics</a> <span class="arithmatex">\(Y_l^m(\theta,\varphi) = e^{i\varphi}P_l^m(\cos\theta)\)</span>, with coefficients e.g. <span class="arithmatex">\(\mathcal P_{l,m}\)</span> that only depend on <span class="arithmatex">\(r\)</span>:</p>
<div class="arithmatex">\[
\mathcal P = \sum_{l=0}^{L}\sum_{m = -l}^lP_{l,m}(r)Y_l^m(\theta,\varphi)
\]</div>
<p>To be rigurous, the equal sign can only hold if the upper bound of the summation over <span class="arithmatex">\(l\)</span> is infinity, rather that some maximum degree <span class="arithmatex">\(L\)</span>. However, it is assumed that the maximum degree is chosen such that the truncated series is a good enough approximation to the infinite one so that one can make no distinction between the two. In this manner, one unknown function dependent upon all three coordinates is transformed into <span class="arithmatex">\((L+1)^2\)</span> unknowns dependent upon <span class="arithmatex">\(r\)</span>. The velocity (or induced magnetic field) thus involves twice as many coefficients to account for both the poloida and toroidal potentials, each involving <span class="arithmatex">\((L+1)^2\)</span> coefficients.</p>
<p>This greatly simplifies the expressions for all the terms in the <span class="arithmatex">\(u\)</span> and <span class="arithmatex">\(v\)</span> sections. These sections can be built term by term, in what Kore calls <em>operators</em>. Consider, for example, the first term in the momentum equation, <span class="arithmatex">\(\lambda\mathbf u\)</span> (see <a href="https://yorchmcm.github.io/kore_sandbox/3nondim/">Non-dimensionalization</a>). When writing the <span class="arithmatex">\(v\)</span> section, this term will turn into <span class="arithmatex">\(\mathbf r\cdot\nabla\times\mathbf u\)</span>. If one does the (very extensive) math, this is simply <span class="arithmatex">\(-r^2\nabla^2_s\mathcal P\)</span>, where <span class="arithmatex">\(\nabla^2_s\)</span> represents the surface laplacian, i.e. the standard laplacian with all radial derivatives removed. By virtue of the properties of the spherical harmonics, such a quantiy can be written as:</p>
<div class="arithmatex">\[
\mathbf r\cdot\nabla\times\mathbf u = -r^2\nabla^2_s\mathcal P = \sum_{l=0}^{L}\sum_{m = -l}^ll(l+1)\mathcal P_{l,m}(r)Y_l^m(\theta,\varphi)
\]</div>
<p>To simplify the notation, one may write just the <span class="arithmatex">\(l,m\)</span> coefficients of that series as below:</p>
<div class="arithmatex">\[
(\mathbf r\cdot\nabla\times\mathbf u)_{l,m} = l(l+1)\mathcal P_{l,m}
\]</div>
<p>Kore calls this the <em>operator</em> <span class="arithmatex">\(u\)</span> in the <span class="arithmatex">\(v\)</span> section. A less trivial example - but a more informative one for later sections - is the <em>viscous diffusion</em> operator in the <span class="arithmatex">\(u\)</span> section, i.e. the projected second curl of the viscous force:</p>
<div class="arithmatex">\[
(\mathbf r\cdot\nabla\times\nabla\times\nabla^2\mathbf u)_{l,m} = \frac{d^4\mathcal P_{l,m}}{dr^4} + \frac{4}{r}\frac{d^3\mathcal P_{l,m}}{dr^3} - \frac{2l(l+1)}{r^2}\frac{d^2\mathcal P_{l,m}}{dr^2} + \frac{l(l+1)(l^2+l-2)}{r^4}\mathcal P_{l,m}
\]</div>
<p>Such a process is followed for all the terms in the equation, through convenient use of the properties of spherical harmonics and their derivatives. Some need more algebra than others to be written in a useful manner. The Coriolis term results in a coupling between the poloidal and toroidal coefficients <span class="arithmatex">\(\mathcal P_{l,m}\)</span> and <span class="arithmatex">\(\mathcal T_{l,m}\)</span>, so that each section <span class="arithmatex">\(u\)</span> and <span class="arithmatex">\(v\)</span> will <em>in principle</em> involve all <span class="arithmatex">\(2(L+1)^2\)</span> unknowns. When putting all operators together, each section represents an equatlity between two series, so their coefficients are made to match. This results in a total of <span class="arithmatex">\((L+1)^2\)</span> equations per section. The two sections then allow to solve all <span class="arithmatex">\(2(L+1)^2\)</span> unknowns.</p>
<p>When this process is carried out explicitely, however, two things occur that allow to reduce the size of the system:</p>
<ul>
<li>The equations for the <span class="arithmatex">\(u\)</span> and <span class="arithmatex">\(v\)</span> sections do not mix coefficients with different order <span class="arithmatex">\(m\)</span>, so that one could gather all equations with the same <span class="arithmatex">\(m\)</span> and solve them independently. For this reason, Kore works in a <em>per-order</em> basis, where a value of <span class="arithmatex">\(m\)</span> is specified and the appropriate system is built. Each order <span class="arithmatex">\(m\)</span> contains only <span class="arithmatex">\(2(L-|m|+1)\)</span> terms and unknowns.</li>
<li>Within a fixed order <span class="arithmatex">\(m\)</span>, each poloidal coefficient <span class="arithmatex">\(\mathcal P_{l,m}\)</span> is only related in the <span class="arithmatex">\(u\)</span> section with the toroidal coefficients of adjacent degree, i.e. <span class="arithmatex">\(\mathcal T_{l+1,m}\)</span> and <span class="arithmatex">\(\mathcal T_{l-1,m}\)</span>. Similarly, the <span class="arithmatex">\(v\)</span> section only relates each toroidal coefficient <span class="arithmatex">\(\mathcal T_{l,m}\)</span> with poloidal coefficients <span class="arithmatex">\(\mathcal P_{l+1,m}\)</span> and <span class="arithmatex">\(\mathcal P_{l-1,m}\)</span>. This results in couplings that skip every other degree, so that poloidal coefficients of even degree will <strong>only</strong> be coupled with toroidal coefficients of odd degree - and viceversa. Thus, one could effectively build a system with only poloidal terms of a single parity and toroidal terms of the other parity. These only represent half of the coefficients, and so the size of the system is further reduced to just <span class="arithmatex">\(L-|m|+1\)</span>. Kore follows this simplification and only builds the system pertaining to the parity that is specified.</li>
</ul>
<p>This second point has geometric significance. Note that the parity of the spherical harmonic functions with respect to the <span class="arithmatex">\(\cos\theta\)</span> variable is given by the parity of their degree: harmonics with even degree are even themselves. Thus, harmonics with even parity are symmetric across the equator, while harmonics with odd parity are antisymmetric. A solution yields a set of poloidal coefficients of one parity and a set of toroidal coefficients of the opposing parity. By writing the expressions out and reasoning what <em>equatorial symmetry</em> means for each of the three components of <span class="arithmatex">\(\mathbf u\)</span>, it turns out that the parity of <span class="arithmatex">\(\mathbf u\)</span> is the same as that of <span class="arithmatex">\(\mathcal P\)</span> and opposite to that of <span class="arithmatex">\(\mathcal T\)</span>. A system with even degrees for <span class="arithmatex">\(\mathcal P_{l,m}\)</span> produces a symmetric flow, and viceversa. It is this symmetry of the solution that Kore uses to build the appropriate system of equations.</p>
<p>Note that this set of equations has two very distinct halves: one coming from the <span class="arithmatex">\(u\)</span> section, the other coming from the <span class="arithmatex">\(v\)</span> section. Within each half, the equations are exactly the same, but they just involve different poloidal-toroidal coefficients. If one was to write them in matrix form, where each entry is an operator, they would find that the rows within each half just get displaced.</p>
<h2 id="radial-discretization-inner-cores-and-symmetry-considerations">Radial discretization, inner cores and symmetry considerations</h2>
<p>The previous angular discretization results in a set of <span class="arithmatex">\(L-|m|+1\)</span> ODEs in <span class="arithmatex">\(r\)</span> to solve for all the involved poloidal-toroidal coefficients. To solve them numerically, the radial dependance of each coefficient on <span class="arithmatex">\(r\)</span> is expressed in terms of <a href="https://en.wikipedia.org/wiki/Chebyshev_polynomials">Chebyshev functions</a> <span class="arithmatex">\(T_k(r)\)</span> as:</p>
<div class="arithmatex">\[
\mathcal P_{l,m} = \sum_{k=0}^N\mathcal P_{l,m}^kT_k(r)\ \ \ \ \ \ \ \ \ \ \ \ \ \mathcal T_{l,m} = \sum_{k=0}^N\mathcal T_{l,m}^kT_k(r)
\]</div>
<p>Here, the coefficients <span class="arithmatex">\(\mathcal P_{l,m}^k\)</span> are constants and do not depend on any spatial coordinate. Again, the equalities should only hold for an infinite sum, but the truncated <span class="arithmatex">\(N+1\)</span> term expansion is assumed to be good enough and indistinguishable from the infinite series. By means of this expansion, each one of the <span class="arithmatex">\(L-|m|+1\)</span> equations obtained from the angular discretization can be written as an equality between two series, whose terms are made to match. Although the idea is the same as with the angular discretization, the process in this case is somewhat more complicated because the Chebyshev family does not offer as convenient differentiation properties as those of the spherical harmonics, but rather involve other families of polynomials jointly known as the <em>ultraspherical</em> or <a href="https://en.wikipedia.org/wiki/Gegenbauer_polynomials"><em>Gegenbauer</em> polynomials</a>. A detailed explanation of the full extent of the discretization in terms of Gegenbauer polynomials is provided by <a href="https://epubs.siam.org/doi/abs/10.1137/120865458">Olver and Townsend (2013)</a>. It is this algorithm that Kore implements, and a short keynote summary is provided here.</p>
<p>The algorithm is thought of as working with vectors and vector bases. Each family of Gegenbauer polynomials has a generating function whose behaviour is determined by a parameter <span class="arithmatex">\(\lambda\)</span> and thus the family is denoted as <span class="arithmatex">\(C^{(\lambda)}\)</span>, with each member of the family being denoted as <span class="arithmatex">\(C^{(\lambda)}_k\)</span>. A function can be written as an expansion series with any of those families, and a vector collecting the coefficients of the series in each family is said to be <em>in the basis</em> of that family. Differentiation of a function written in a <span class="arithmatex">\(C^{(\lambda)}\)</span> series can be performed by means of a matrix operation <span class="arithmatex">\(\mathcal D_{\lambda}\)</span>, which acts on the vector of coefficients in the <span class="arithmatex">\(C^{(\lambda)}\)</span> basis and returns the coefficients of the derivative, now in the <span class="arithmatex">\(C^{(\lambda+1)}\)</span> basis. A second derivative is just the successive application of such a matrix, the result of which is provided in the <span class="arithmatex">\(C^{(\lambda+2)}\)</span> basis. One can imagine that an operator involving different derivatives of different orders, like the viscous diffusion operator above, will naturally involve vectors in different bases. Writing them in the same basis is achieved by pre-multiplication with a matrix <span class="arithmatex">\(\mathcal S_\lambda\)</span>, which takes a vector in the <span class="arithmatex">\(C^{(\lambda)}\)</span> basis and returns the coefficients of the same function in the <span class="arithmatex">\(C^{(\lambda+1)}\)</span> basis. Products between two functions can be done in <em>Gegenbauer space</em> by using a matrix <span class="arithmatex">\(\mathcal M_\lambda\)</span>, which is built with the coefficients of one of the functions and pre-multiplies the vector of coefficients of the other function. The result is the vector of coefficients of the product of the two functions. The inputs need to be in the same basis, and the output is given in that basis as well.</p>
<p>In the end, each of the operators obtained in the angular discretization can be written by an appropriate combination of these <span class="arithmatex">\(\mathcal D_\lambda\)</span>, <span class="arithmatex">\(\mathcal S_\lambda\)</span> and <span class="arithmatex">\(\mathcal M_\lambda\)</span>. This is exactly what Kore does. For each of the <span class="arithmatex">\(L-|m|+1\)</span> equations obtained in the angular discretization, the operators apply on the vector of coefficients of each of the involved <span class="arithmatex">\(\mathcal P_{l,m}\)</span> and <span class="arithmatex">\(\mathcal T_{l,m}\)</span>. Each of these scalar equations then turn into <span class="arithmatex">\(N+1\)</span> scalar equations which, stacked together, constitue a system of <span class="arithmatex">\((N+1)(L-|m|+1)\)</span> equations to solve for the same number of unknowns. This step effectively turns each entry of the matrix obtained with the angular discretization into a sub-matrix itself, while each entry in the unknown vector from before gets turned into a sub-vector itself. The structure that was mentioned earlier for the entries of the matrix in the angular discretization is maintained by the submatrices in this second discretization.</p>
<p>Something important to keep in mind when using Chebyshev or Gegenbauer polynomials is that their domain is limited to the <span class="arithmatex">\([-1,1]\)</span> interval. Therefore, the radial domain of the problem needs to be mapped accordingly. Here, two situations need to be distinguished.</p>
<ul>
<li>In the presence of an inner core, the radial domain is <span class="arithmatex">\([r_{icb},r_{cmb}]\)</span>. This interval of <span class="arithmatex">\(r\)</span> is scaled and shifted to match the <span class="arithmatex">\([-1,1]\)</span> interval of <span class="arithmatex">\(x\)</span> as:</li>
</ul>
<div class="arithmatex">\[
x = 2\frac{r - r_{icb}}{r_{cmb} - r_{icb}} - 1
\]</div>
<ul>
<li>In the absence of an inner core, mapping the interval <span class="arithmatex">\([0,r_{cmb}]\)</span> to the interval <span class="arithmatex">\([-1,1]\)</span> creates conflicts at the origin (see <a href="https://academic.oup.com/gji/article/216/2/777/5159470">Rekier et al., 2019</a>) and it is more convenient to map the whole diameter <span class="arithmatex">\([-r_{cmb}, r_{cmb}]\)</span> to the Chebyshev domain. This is done through the transformation:</li>
</ul>
<div class="arithmatex">\[
x = \frac{r}{r_{cmb}}
\]</div>
<p>In any case, the assumed symmetry that was used in the angular discretization is to be mantained, which imposes further restrictions on the shape of the radial functions. In the end, only Chebyshev polynomials with the same parity as the flow can be part of the solution, which is to say that all coefficients corresponding to the other parity need to vanish. Imposing this reduces the number of equations and unknowns by half, yielding a final system with <span class="arithmatex">\((N+1)(L-|m|+1)/2\)</span> equations and unknowns.</p>
<h2 id="boundary-conditions-generalization-and-final-notes">Boundary conditions, generalization and final notes</h2>
<p>For a fully defined problem, the differential equation(s) discretized above need to be complemented with boundary conditions, all of which are discretized in exactly the same manner. TODO: Not sure about this. There is this part with generalized spherical harmonics and the canonical basis that I am not sure how it translates to the final matrix system.</p>
<p>Although the numerical scheme has been illustrated using the momentum equation, exactly the same type of procedure can be followed for the induction equation and its <span class="arithmatex">\(f\)</span> and <span class="arithmatex">\(g\)</span> sections, and the already scalar equations of heat and composition. However, the induction equation involves a product of the induced field <span class="arithmatex">\(\mathbf b\)</span> and the background field <span class="arithmatex">\(\mathbf B_o\)</span>, both of which are written in spherical harmonics (see . The product of two spherical harmonics involves the so-called <a href="https://en.wikipedia.org/wiki/3-j_symbol">Wigner 3-j symbols</a>, which greatly complicates the analytical approach. In practice, in order to know what derivatives are needed in each operator, a Mathematica package called <a href="https://meetingorganizer.copernicus.org/EPSC2013/EPSC2013-919.pdf">TenGSHui</a> had been previously used, and the operators it output were implemented in Kore.</p>
<p>Another final detail is that, in the implementation of Kore, factors of <span class="arithmatex">\(1/r\)</span> have been removed from the differential equations for the <span class="arithmatex">\(r\)</span>-dependent coefficients of the spherical harmonic expansions. These equations have been multiplied by whatever power of <span class="arithmatex">\(r\)</span> is required to eliminate all <span class="arithmatex">\(r\)</span> from the denominators. This renders all differential operators in <span class="arithmatex">\(r\)</span> to be of the form <span class="arithmatex">\(r^\alpha(d/dr)^\beta\)</span> with some <span class="arithmatex">\(\alpha,\beta\geq0\)</span>.</p>
<p>At the end of the whole discretization process, the whole system can be written in matrix form. Due to the shape of <a href="https://yorchmcm.github.io/kore_sandbox/3nondim/">the original equations</a>, this system will have two parts: one of them proportional to <span class="arithmatex">\(\lambda\)</span> - which has not really been fixed - and another part independent of it. This allows to write the system in the form <span class="arithmatex">\(\mathbf A\mathbf x = \lambda\mathbf B\mathbf x\)</span>, with <span class="arithmatex">\(\mathbf x\)</span> being the vector containing all <span class="arithmatex">\((N+1)(L-|m|+1)/2\)</span> unknowns. This is a (massive) generalized eigenvalue problem, which is not solved entirely but rather an algorithm is used to solve only for eigenvalues close to a specified ''fixed point''.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top", "content.code.copy"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>